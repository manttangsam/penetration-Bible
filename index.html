<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìƒëª…ìƒ˜êµíšŒ ì „êµì¸ 180ì¼ ì„±ê²½ í†µë…í‘œ</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Google Font: Noto Serif KR -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Noto Serif KR', serif; background: #f4f6fb; margin: 0; padding: 1rem; }
    .container { max-width: 800px; margin: auto; background: #fff; padding: 2rem; border-radius: 10px; }
    h1 { text-align: center; margin-bottom: 1rem; }
    .input-group { margin-bottom: 1rem; }
    .stats { display: flex; justify-content: space-around; margin-top: 1rem; }
    .stat-box { flex: 1; color: #fff; padding: 1rem; border-radius: 8px; margin: 0 0.5rem; text-align: center; }
    .done { background: linear-gradient(to right,#4caf50,#81c784); }
    .inprogress { background: linear-gradient(to right,#2196f3,#64b5f6); }
    .remaining { background: linear-gradient(to right,#ff9800,#ffb74d); }
    .stat-box h2 { margin: 0; font-size: 2rem; }
    #chartContainer { text-align: center; margin-top: 1rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: center; white-space: nowrap; }
    th { background: #eef2f7; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“– ìƒëª…ìƒ˜êµíšŒ ì „êµì¸ 180ì¼ ì„±ê²½ í†µë…í‘œ</h1>
    <div class="input-group">
      <input type="text" id="username" class="form-control" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
      <button id="startButton" class="btn btn-primary">ì‹œì‘í•˜ê¸°</button>
    </div>
    <div id="stats" class="stats hidden">
      <div class="stat-box done"><h2 id="doneCount">0</h2><div>ì™„ë£Œ</div></div>
      <div class="stat-box inprogress"><h2 id="percent">0%</h2><div>ì§„í–‰ë¥ </div></div>
      <div class="stat-box remaining"><h2 id="leftCount">180</h2><div>ë‚¨ì€</div></div>
    </div>
    <div id="chartContainer" class="hidden">
      <canvas id="progressChart" width="200" height="200"></canvas>
    </div>
    <table id="bibleTable" class="table table-bordered hidden">
      <thead>
        <tr><th>íšŒì°¨</th><th>ì‹œì‘</th><th>ì¢…ë£Œ</th><th>ì‹œí¸</th><th>ì ì–¸</th><th>ì½ìŒ</th><th>ë‚ ì§œ</th></tr>
      </thead>
      <tbody id="bibleBody"></tbody>
    </table>
  </div>

  <!-- Scripts at end for correct load -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="data.js"></script>
  <script>
    // Logic
    let bibleData = window.bibleData;
    let userKey = '';

    function startReading() {
      const name = document.getElementById('username').value.trim();
      if (!name) { alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); document.getElementById('username').focus(); return; }
      userKey = 'bible_' + name;
      document.getElementById('stats').classList.remove('hidden');
      document.getElementById('chartContainer').classList.remove('hidden');
      document.getElementById('bibleTable').classList.remove('hidden');
      renderTable();
    }

    function renderTable() {
      const tbody = document.getElementById('bibleBody'); tbody.innerHTML = '';
      let done = 0;
      const saved = JSON.parse(localStorage.getItem(userKey) || '{}');
      bibleData.forEach((row, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row.íšŒì°¨}</td><td>${row.ì‹œì‘}</td><td>${row.ì¢…ë£Œ}</td><td>${row.ì‹œí¸}</td><td>${row.ì ì–¸}</td>
          <td><input type="checkbox" id="cb${i}"></td><td id="dt${i}">-</td>`;
        tbody.appendChild(tr);
        const cb = document.getElementById('cb'+i);
        const dt = document.getElementById('dt'+i);
        cb.checked = !!saved[row.íšŒì°¨];
        dt.textContent = saved[row.íšŒì°¨] || '-';
        if (cb.checked) done++;
        cb.addEventListener('change', () => {
          if (cb.checked) saved[row.íšŒì°¨] = new Date().toISOString().split('T')[0];
          else delete saved[row.íšŒì°¨];
          localStorage.setItem(userKey, JSON.stringify(saved));
          renderTable();
        });
      });
      document.getElementById('doneCount').textContent = done;
      document.getElementById('percent').textContent = Math.round(done/bibleData.length*100) + '%';
      document.getElementById('leftCount').textContent = bibleData.length - done;
      drawChart(done, bibleData.length - done);
    }

    function drawChart(done, left) {
      const ctx = document.getElementById('progressChart').getContext('2d');
      if (window.chartInstance) chartInstance.destroy();
      chartInstance = new Chart(ctx, {
        type: 'doughnut',
        data: { labels: ['ì™„ë£Œ','ë‚¨ì€'], datasets: [{ data:[done,left], backgroundColor:['#4caf50','#ccc'] }] },
        options: { responsive:true, plugins:{ legend:{ position:'bottom' } } }
      });
    }

    document.getElementById('startButton').addEventListener('click', startReading);
  </script>
</body>
</html>
